# 🏗️ 시스템 아키텍처 다이어그램

## 📊 전체 시스템 구조도

```mermaid
graph TB
    subgraph "🌐 클라이언트 (브라우저)"
        FC[채팅 UI<br/>React App<br/>:3001]
        FA[관리자 UI<br/>React App<br/>:3002]
    end
    
    subgraph "🖥️ 백엔드 서버"
        subgraph "Django Application"
            API[REST API<br/>Django REST Framework]
            WS[WebSocket<br/>Django Channels]
            AUTH[인증 시스템]
        end
        
        subgraph "AI 서비스"
            LLM[LLM Service<br/>llama-cpp-python]
            RAG[RAG Service<br/>ChromaDB]
            PT[Prompt Templates]
        end
        
        subgraph "데이터 저장소"
            DB[(SQLite DB)]
            VDB[(Vector DB<br/>ChromaDB)]
            MF[Model Files<br/>GGUF]
        end
    end
    
    FC -->|HTTP/HTTPS| API
    FC -->|WebSocket| WS
    FA -->|HTTP/HTTPS| API
    
    API --> AUTH
    WS --> AUTH
    
    API --> LLM
    WS --> LLM
    
    LLM --> PT
    LLM --> RAG
    RAG --> VDB
    
    API --> DB
    WS --> DB
    LLM --> MF
    
    style FC fill:#e1f5fe
    style FA fill:#e1f5fe
    style LLM fill:#fff3e0
    style DB fill:#f3e5f5
    style VDB fill:#f3e5f5
```

## 🔄 데이터 플로우 다이어그램

```mermaid
sequenceDiagram
    participant U as 사용자
    participant F as 프론트엔드
    participant A as API Server
    participant W as WebSocket
    participant L as LLM Service
    participant D as Database
    
    U->>F: 메시지 입력
    F->>W: WebSocket 연결
    W->>D: 메시지 저장
    W->>L: AI 응답 요청
    
    loop 스트리밍
        L->>W: 텍스트 청크
        W->>F: 실시간 전송
        F->>U: 화면 표시
    end
    
    L->>D: 완성된 응답 저장
    W->>F: 완료 신호
```

## 🗂️ 컴포넌트 아키텍처

```mermaid
graph LR
    subgraph "프론트엔드 레이어"
        UI[UI Components]
        ST[State Management]
        SV[Services]
    end
    
    subgraph "통신 레이어"
        HTTP[HTTP Client<br/>Axios]
        WS2[WebSocket Client]
    end
    
    subgraph "백엔드 레이어"
        RT[Router]
        VW[Views]
        SR[Serializers]
        CS[Consumers]
    end
    
    subgraph "비즈니스 로직"
        MD[Models]
        SVC[Services]
        VAL[Validators]
    end
    
    subgraph "AI 레이어"
        MOD[Model Loader]
        GEN[Text Generator]
        EMB[Embeddings]
    end
    
    UI --> ST
    ST --> SV
    SV --> HTTP
    SV --> WS2
    
    HTTP --> RT
    WS2 --> CS
    
    RT --> VW
    VW --> SR
    VW --> MD
    CS --> MD
    
    MD --> SVC
    SVC --> VAL
    SVC --> MOD
    MOD --> GEN
    MOD --> EMB
```

## 🔐 인증 플로우

```mermaid
graph TD
    Start([사용자 접속]) --> Check{로그인 여부}
    Check -->|No| Login[로그인 페이지]
    Check -->|Yes| Main[메인 페이지]
    
    Login --> Input[사용자명 입력]
    Input --> Submit[로그인 요청]
    Submit --> API2[API 서버]
    
    API2 --> Validate{검증}
    Validate -->|성공| Token[토큰 발급]
    Validate -->|실패| Error[에러 메시지]
    
    Token --> Store[토큰 저장]
    Store --> Main
    Error --> Login
    
    Main --> Request[API 요청]
    Request --> CheckToken{토큰 확인}
    CheckToken -->|유효| Response[응답]
    CheckToken -->|만료| Refresh[갱신/재로그인]
```

## 💾 데이터베이스 ERD

```mermaid
erDiagram
    USER ||--o{ CHAT_SESSION : creates
    CHAT_SESSION ||--o{ MESSAGE : contains
    USER {
        int id PK
        string username
        string email
        datetime created_at
    }
    
    CHAT_SESSION {
        int id PK
        string title
        int user_id FK
        datetime created_at
        datetime updated_at
    }
    
    MESSAGE {
        int id PK
        int session_id FK
        text content
        boolean is_user
        datetime timestamp
    }
    
    PROMPT_TEMPLATE ||--o{ PROMPT_EXAMPLE : has
    PROMPT_TEMPLATE {
        int id PK
        string name
        text system_prompt
        boolean is_active
        datetime created_at
    }
    
    PROMPT_EXAMPLE {
        int id PK
        int template_id FK
        text user_input
        text assistant_output
    }
    
    RAG_DOCUMENT {
        int id PK
        string title
        text content
        json metadata
        datetime created_at
    }
```

## 🚀 배포 아키텍처

```mermaid
graph TB
    subgraph "개발 환경"
        DEV[개발자 PC]
        LOCAL[로컬 서버<br/>localhost:8000]
    end
    
    subgraph "프로덕션 환경"
        subgraph "클라우드/서버"
            LB[로드 밸런서]
            subgraph "웹 서버"
                WEB1[Nginx]
                WEB2[Nginx]
            end
            subgraph "앱 서버"
                APP1[Django + Gunicorn]
                APP2[Django + Gunicorn]
            end
            subgraph "데이터베이스"
                PDB[(PostgreSQL)]
                REDIS[(Redis)]
            end
            subgraph "AI 서버"
                GPU[GPU Server<br/>Model Serving]
            end
        end
    end
    
    subgraph "CI/CD"
        GIT[Git Repository]
        CI[GitHub Actions]
        DOCKER[Docker Registry]
    end
    
    DEV --> GIT
    GIT --> CI
    CI --> DOCKER
    DOCKER --> LB
    
    LB --> WEB1
    LB --> WEB2
    WEB1 --> APP1
    WEB2 --> APP2
    APP1 --> PDB
    APP2 --> PDB
    APP1 --> REDIS
    APP2 --> REDIS
    APP1 --> GPU
    APP2 --> GPU
```

## 📈 성능 모니터링

```mermaid
graph LR
    subgraph "메트릭 수집"
        APP[Application]
        LOG[Logs]
        MET[Metrics]
    end
    
    subgraph "모니터링 도구"
        PROM[Prometheus]
        GRAF[Grafana]
        ELK[ELK Stack]
    end
    
    subgraph "알림"
        ALERT[Alert Manager]
        SLACK[Slack]
        EMAIL[Email]
    end
    
    APP --> LOG
    APP --> MET
    LOG --> ELK
    MET --> PROM
    PROM --> GRAF
    PROM --> ALERT
    ALERT --> SLACK
    ALERT --> EMAIL
```

## 🔧 기술 스택 맵

```mermaid
mindmap
  root((LLM Chat System))
    Frontend
      React 19
      TypeScript
      Material-UI
      Axios
      WebSocket API
    Backend
      Django 5.2
      Django REST Framework
      Django Channels
      Python 3.11
    AI/ML
      llama-cpp-python
      Mistral 7B
      ChromaDB
      Sentence Transformers
    Database
      SQLite (Dev)
      PostgreSQL (Prod)
      Redis (Cache)
      ChromaDB (Vectors)
    DevOps
      Docker
      GitHub Actions
      Nginx
      Gunicorn
    Tools
      VS Code
      Postman
      Git
      uv (Package Manager)
```

## 🎯 시스템 플로우 차트

```mermaid
flowchart TD
    Start([시작]) --> UserInput[사용자 메시지 입력]
    UserInput --> Validate{입력 검증}
    
    Validate -->|유효| SendWS[WebSocket 전송]
    Validate -->|무효| ShowError[에러 표시]
    ShowError --> UserInput
    
    SendWS --> SaveUser[사용자 메시지 저장]
    SaveUser --> CheckRAG{RAG 사용?}
    
    CheckRAG -->|Yes| SearchDocs[문서 검색]
    CheckRAG -->|No| PreparePrompt[프롬프트 준비]
    
    SearchDocs --> AddContext[컨텍스트 추가]
    AddContext --> PreparePrompt
    
    PreparePrompt --> LoadModel[모델 로드]
    LoadModel --> Generate[응답 생성]
    
    Generate --> Stream{스트리밍?}
    Stream -->|Yes| SendChunk[청크 전송]
    SendChunk --> MoreChunks{더 있음?}
    MoreChunks -->|Yes| SendChunk
    MoreChunks -->|No| Complete[완료]
    
    Stream -->|No| SendFull[전체 전송]
    SendFull --> Complete
    
    Complete --> SaveAI[AI 응답 저장]
    SaveAI --> UpdateUI[UI 업데이트]
    UpdateUI --> End([종료])
```

## 📱 반응형 디자인 구조

```mermaid
graph TD
    subgraph "디바이스별 레이아웃"
        Mobile[모바일<br/>320-768px]
        Tablet[태블릿<br/>769-1024px]
        Desktop[데스크톱<br/>1025px+]
    end
    
    subgraph "컴포넌트 적응"
        Nav[네비게이션]
        Chat[채팅 영역]
        Side[사이드바]
    end
    
    Mobile --> |햄버거 메뉴| Nav
    Mobile --> |전체 화면| Chat
    Mobile --> |숨김| Side
    
    Tablet --> |축소 메뉴| Nav
    Tablet --> |70%| Chat
    Tablet --> |30%| Side
    
    Desktop --> |전체 메뉴| Nav
    Desktop --> |60%| Chat
    Desktop --> |40%| Side
```

## 🔒 보안 아키텍처

```mermaid
graph TB
    subgraph "보안 레이어"
        subgraph "네트워크 보안"
            HTTPS[HTTPS/TLS]
            CORS[CORS Policy]
            FW[Firewall]
        end
        
        subgraph "인증/인가"
            TOKEN[Token Auth]
            PERM[Permissions]
            SESS[Session Management]
        end
        
        subgraph "데이터 보안"
            ENC[Encryption]
            HASH[Password Hashing]
            VALID[Input Validation]
        end
        
        subgraph "AI 보안"
            PROMPT[Prompt Injection 방어]
            FILTER[Content Filtering]
            LIMIT[Rate Limiting]
        end
    end
    
    Client[클라이언트] --> HTTPS
    HTTPS --> CORS
    CORS --> FW
    FW --> TOKEN
    TOKEN --> PERM
    PERM --> SESS
    SESS --> VALID
    VALID --> PROMPT
    PROMPT --> FILTER
    FILTER --> LIMIT
    LIMIT --> Server[서버]
```

## 📚 참고 자료

### 시스템 설계
- [System Design Primer](https://github.com/donnemartin/system-design-primer)
- [웹 아키텍처 입문](https://blog.rhostem.com/posts/2018-07-22-web-architecture-101)

### 다이어그램 도구
- [Mermaid 공식 문서](https://mermaid.js.org/)
- [Draw.io](https://app.diagrams.net/)
- [Lucidchart](https://www.lucidchart.com/)

### 아키텍처 패턴
- [마이크로서비스 아키텍처](https://microservices.io/)
- [클린 아키텍처](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

---

다음 문서: [08-실습-가이드.md](./08-실습-가이드.md) 에서 직접 코드를 수정해봐요!