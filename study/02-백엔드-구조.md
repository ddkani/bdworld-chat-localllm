# 🖥️ 백엔드(서버) 구조 이해하기

## 📌 백엔드란?

백엔드는 웹 애플리케이션의 **뒷단**에서 작동하는 부분입니다. 
- 사용자가 직접 보지 못하는 부분
- 데이터 처리, 저장, 비즈니스 로직 담당
- 레스토랑으로 비유하면 **주방**과 같은 역할

## 🏛️ Django 프레임워크

### Django란?
- Python으로 만들어진 웹 프레임워크
- "배터리 포함" 철학 - 필요한 기능이 대부분 포함됨
- Instagram, Netflix 등에서도 사용

### 프로젝트 vs 앱
```
chat_project/          # 프로젝트 (전체 설정)
├── chat/             # 앱 1 (채팅 기능)
└── llm/              # 앱 2 (AI 모델 기능)
```

## 📂 백엔드 폴더 구조 상세

```
backend/
│
├── 📁 chat_project/        # 메인 프로젝트 설정
│   ├── settings.py        # 전체 설정 파일
│   ├── urls.py           # URL 라우팅 (주소 연결)
│   ├── asgi.py           # 비동기 서버 설정
│   └── wsgi.py           # 동기 서버 설정
│
├── 📁 chat/               # 채팅 앱
│   ├── models.py         # 데이터베이스 모델
│   ├── views.py          # 요청 처리 로직
│   ├── serializers.py    # 데이터 변환
│   ├── consumers.py      # WebSocket 처리
│   ├── urls.py           # 채팅 URL 설정
│   └── migrations/       # DB 변경 이력
│
├── 📁 llm/                # AI 모델 앱
│   ├── models.py         # AI 관련 DB 모델
│   ├── views.py          # AI API 처리
│   ├── llm_service.py    # AI 모델 실행
│   └── management/       # 관리 명령어
│       └── commands/
│
├── 📁 models/             # AI 모델 파일 저장
│   └── mistral-7b.gguf   # 실제 AI 모델
│
├── 📄 manage.py           # Django 관리 스크립트
├── 📄 requirements.txt    # 필요한 패키지 목록
└── 📄 db.sqlite3         # 데이터베이스 파일
```

## 🔑 핵심 파일 설명

### 1. settings.py - 프로젝트 설정
```python
# 설치된 앱들
INSTALLED_APPS = [
    'django.contrib.admin',    # 관리자 페이지
    'channels',                 # 실시간 통신
    'rest_framework',          # REST API
    'chat',                    # 우리가 만든 채팅 앱
    'llm',                     # 우리가 만든 AI 앱
]

# 데이터베이스 설정
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

### 2. models.py - 데이터 모델
```python
# 채팅 세션 모델 예시
class ChatSession(models.Model):
    title = models.CharField(max_length=200)  # 세션 제목
    user = models.CharField(max_length=100)   # 사용자 이름
    created_at = models.DateTimeField()       # 생성 시간
    
# 메시지 모델 예시
class Message(models.Model):
    session = models.ForeignKey(ChatSession)  # 어느 세션의 메시지인지
    content = models.TextField()              # 메시지 내용
    is_user = models.BooleanField()          # 사용자/AI 구분
```

### 3. views.py - API 처리
```python
# 세션 목록 가져오기
class SessionViewSet(viewsets.ModelViewSet):
    def list(self, request):
        sessions = ChatSession.objects.all()
        return Response(sessions)
    
    def create(self, request):
        # 새 세션 생성 로직
        pass
```

### 4. consumers.py - WebSocket 처리
```python
class ChatConsumer(AsyncWebsocketConsumer):
    async def receive(self, text_data):
        # 사용자 메시지 받기
        message = json.loads(text_data)
        
        # AI 응답 생성
        ai_response = await self.generate_ai_response(message)
        
        # 응답 전송
        await self.send(text_data=json.dumps({
            'message': ai_response
        }))
```

## 🔄 요청 처리 흐름

```
1. 사용자 요청
     ↓
2. urls.py (URL 라우팅)
     ↓
3. views.py (비즈니스 로직)
     ↓
4. models.py (데이터베이스)
     ↓
5. serializers.py (데이터 변환)
     ↓
6. 응답 전송
```

## 💾 데이터베이스 구조

### 주요 테이블들
1. **auth_user**: 사용자 정보
2. **chat_session**: 채팅 세션
3. **chat_message**: 메시지
4. **llm_prompttemplate**: 프롬프트 템플릿
5. **llm_ragdocument**: RAG 문서

### 관계도
```
User (사용자)
  ↓ 1:N
ChatSession (채팅 세션)
  ↓ 1:N
Message (메시지)
```

## 🚀 서버 실행 과정

1. **가상환경 활성화**
   ```bash
   source venv/bin/activate  # Mac/Linux
   venv\Scripts\activate     # Windows
   ```

2. **데이터베이스 마이그레이션**
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```

3. **서버 시작**
   ```bash
   python manage.py runserver
   ```

## 🔧 주요 Django 명령어

| 명령어 | 설명 |
|--------|------|
| `python manage.py runserver` | 개발 서버 실행 |
| `python manage.py makemigrations` | DB 변경사항 감지 |
| `python manage.py migrate` | DB 변경사항 적용 |
| `python manage.py createsuperuser` | 관리자 계정 생성 |
| `python manage.py shell` | Django 쉘 실행 |

## 🌐 API 엔드포인트 구조

```
http://localhost:8000/
│
├── /api/
│   ├── /auth/           # 인증 관련
│   │   ├── /login/      # 로그인
│   │   └── /logout/     # 로그아웃
│   │
│   ├── /sessions/       # 세션 관리
│   │   ├── GET          # 목록 조회
│   │   ├── POST         # 새 세션 생성
│   │   └── /{id}/       # 특정 세션
│   │
│   └── /llm/           # AI 모델 관련
│       ├── /prompts/    # 프롬프트
│       └── /rag/        # RAG 문서
│
└── /ws/                 # WebSocket
    └── /chat/{session}/ # 채팅 연결
```

## 📚 학습 자료

### Django 학습
- [Django Girls 튜토리얼 (한국어)](https://tutorial.djangogirls.org/ko/)
- [Django 공식 문서](https://docs.djangoproject.com/ko/5.0/)
- [Django REST Framework 튜토리얼](https://www.django-rest-framework.org/tutorial/quickstart/)

### Python 웹 개발
- [Real Python - Django 튜토리얼](https://realpython.com/get-started-with-django-1/)
- [파이썬 웹 프로그래밍](https://wikidocs.net/book/4542)

### 데이터베이스
- [SQLite 튜토리얼](https://www.sqlitetutorial.net/)
- [SQL 입문서](https://www.w3schools.com/sql/)

### WebSocket
- [Django Channels 문서](https://channels.readthedocs.io/en/stable/)
- [WebSocket 이해하기](https://developer.mozilla.org/ko/docs/Web/API/WebSockets_API)

## 💡 실습 아이디어

1. **새로운 모델 추가하기**
   - 사용자 프로필 모델 만들기
   - 즐겨찾기 기능 추가

2. **API 엔드포인트 만들기**
   - 통계 API 추가
   - 검색 기능 구현

3. **관리자 페이지 커스터마이징**
   - Django Admin 수정
   - 커스텀 액션 추가

## 🤔 생각해볼 문제

1. 왜 프론트엔드와 백엔드를 분리할까요?
2. 데이터베이스는 왜 필요할까요?
3. REST API의 장점은 무엇일까요?

---

다음 문서: [03-프론트엔드-구조.md](./03-프론트엔드-구조.md) 에서 화면 구성을 알아봐요!